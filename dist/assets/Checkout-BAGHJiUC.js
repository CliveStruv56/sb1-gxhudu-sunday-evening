import{u as N,b as v,j as e}from"./index-Be7Y3f13.js";import{u as C,R as g}from"./vendor-react-DBFghe8J.js";import{u as k}from"./demoModeStore-B6ITntvW.js";import{i as T,v as D,g as M,w as A,q,x,c as m,d as O,f as h,T as P}from"./vendor-firebase-_yAk6ILj.js";import{f}from"./vendor-utils-IHwoJ3uH.js";const I={apiKey:"AIzaSyCqm49bAzlJwx2SaTXJQZwrBMMM8BtP_1U",authDomain:"bolt-coffee-shop.firebaseapp.com",projectId:"bolt-coffee-shop",storageBucket:"bolt-coffee-shop.firebasestorage.app",messagingSenderId:"921119001263",appId:"1:921119001263:web:59aa28f9f2ce17ebb6225a"},y=T(I),d=D(y);M(y);try{A(d).catch(s=>{s.code==="failed-precondition"?console.warn("Multiple tabs open, persistence enabled in first tab only"):s.code==="unimplemented"&&console.warn("Browser doesn't support persistence")})}catch(s){console.warn("Error enabling persistence:",s)}const E=async(s,n)=>{const i=f(s,"yyyy-MM-dd"),t=q(m(d,"timeSlots"),x("date","==",i),x("time","==",n));return(await O(t)).size<1},z=async(s,n,i)=>{const t=f(s,"yyyy-MM-dd");await h(m(d,"timeSlots"),{date:t,time:n,orderId:i,createdAt:P.now()})},Q=()=>{const{items:s,getTotal:n,clearCart:i,collectionTime:t}=N(),{user:o}=v(),{isDemoMode:l}=k(),r=C(),[p,u]=g.useState(!1);g.useEffect(()=>{(s.length===0||!t)&&r("/cart"),o||(r("/"),alert("Please sign in to complete your order"))},[s,t,r,o]);const w=async()=>{if(!(!t||!o)){u(!0);try{if(!await E(t.date,t.time)){alert("Sorry, this time slot is no longer available. Please select another time."),r("/collection-time");return}const b={items:s.map(c=>({product:{name:c.product.name,price:Number(c.product.price)},quantity:Number(c.quantity),selectedOption:c.selectedOption||null})),total:Number(n()),pickupDate:t.date.toISOString(),pickupTime:t.time,createdAt:new Date().toISOString(),userId:o.uid,userEmail:o.email||"",paymentStatus:l?"completed":"pending",status:"new"},S=await h(m(d,"orders"),b);await z(t.date,t.time,S.id),r("/confirmation",{state:{orderDetails:b},replace:!0}),setTimeout(()=>i(),100)}catch(a){console.error("Error placing order:",a),alert("There was an error placing your order. Please try again.")}finally{u(!1)}}};if(!t||!o)return null;const j=n();return e.jsxs("div",{className:"max-w-2xl mx-auto",children:[e.jsx("h2",{className:"text-2xl font-bold mb-6",children:"Checkout"}),l&&e.jsxs("div",{className:"bg-yellow-100 text-yellow-800 p-4 rounded-lg mb-6",children:[e.jsx("p",{className:"font-medium",children:"Demo Mode Active"}),e.jsx("p",{className:"text-sm",children:"Orders will be processed without real payments."})]}),e.jsxs("div",{className:"bg-white shadow-md rounded-lg p-6 mb-8",children:[e.jsx("h3",{className:"text-xl font-semibold mb-4",children:"Collection Time"}),e.jsxs("p",{className:"text-lg",children:[t.date.toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"})," at ",t.time]})]}),e.jsxs("div",{className:"bg-white shadow-md rounded-lg p-6 mb-8",children:[e.jsx("h3",{className:"text-xl font-semibold mb-4",children:"Order Summary"}),s.map(a=>e.jsxs("div",{className:"flex justify-between mb-3 pb-3 border-b",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:a.product.name}),e.jsxs("p",{className:"text-sm",children:["Quantity: ",a.quantity]})]}),e.jsxs("p",{className:"font-medium",children:["£",(a.product.price*a.quantity).toFixed(2)]})]},`${a.product.id}-${a.selectedOption||"no-option"}`)),e.jsx("div",{className:"mt-4 pt-4 border-t",children:e.jsxs("div",{className:"flex justify-between text-lg font-bold",children:[e.jsx("span",{children:"Total:"}),e.jsxs("span",{children:["£",j.toFixed(2)]})]})})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx("button",{onClick:()=>r("/menu"),className:"flex-1 bg-gray-200 text-gray-700 py-4 px-6 rounded-lg text-lg font-semibold hover:bg-gray-300 transition-colors",children:"Continue Shopping"}),e.jsx("button",{onClick:()=>r("/collection-time"),className:"flex-1 bg-gray-200 text-gray-700 py-4 px-6 rounded-lg text-lg font-semibold hover:bg-gray-300 transition-colors",children:"Change Collection Time"}),e.jsx("button",{onClick:w,disabled:p,className:"flex-1 bg-green-600 text-white py-4 px-6 rounded-lg text-lg font-semibold hover:bg-green-700 transition-colors disabled:bg-gray-400",children:p?"Processing...":l?"Place Demo Order":"Place Order"})]})]})};export{Q as default};
//# sourceMappingURL=Checkout-BAGHJiUC.js.map
